-- ==================================================
-- SQL JOIN 및 집계 예제 정리
-- 이 파일은 CROSS JOIN, INNER JOIN (이퀴 조인), Non-ANSI JOIN 구문과
-- GROUP BY, COUNT, SUM 등의 집계 함수를 포함한 SQL 예제를 설명합니다.
-- 각 섹션별로 SQL 구문과 처리 목적, 그리고 예상 결과를 주석으로 포함하고 있습니다.
-- ==================================================

---------------------------------------------------------
-- [CROSS JOIN 예제]
-- 부서와 사원 테이블의 모든 조합을 생성한 후,
-- 이름이 '배재용'인 사원만 필터링합니다.
SELECT 부서.부서번호,
       부서명,
       이름,
       사원.부서번호
FROM 부서            -- NON-ASNI 구문 ---> "FROM 부서, 사원"
CROSS JOIN 사원      -- NON-ASNI 구문 ---> "CROSS JOIN 사원" 삭제
WHERE 이름 = '배재용';
 
/*
[예상 결과]
-----------------------------------------------------------
| 부서번호 | 부서명   | 이름    | 사원.부서번호              |
-----------------------------------------------------------
| 101      | 영업부   | 배재용  | 101                        |
| 102      | 기술부   | 배재용  | 102                        |
-----------------------------------------------------------
(예시: 부서와 사원을 CROSS JOIN 한 후, 이름이 '배재용'인 경우)
*/

---------------------------------------------------------
-- [이퀴 조인 (INNER JOIN) 예제 - ANSI 표준 구문]
-- 사원 테이블과 부서 테이블을 부서번호 기준으로 동등(이퀴) 조인하여,
-- 이름이 '이소미'인 사원의 사원번호, 직위, 부서번호, 부서명을 조회합니다.
SELECT 사원번호,
       직위,
       사원.부서번호,
       부서명
FROM 사원
INNER JOIN 부서
  ON 사원.부서번호 = 부서.부서번호  -- 이퀴 조인: 두 테이블의 부서번호 값이 동일한 행을 결합
WHERE 이름 = '이소미';
 
/*
[예상 결과]
----------------------------------------------------------
| 사원번호 | 직위      | 부서번호  | 부서명                 |
----------------------------------------------------------
| 2001    | 대리      | 101       | 영업부                 |
----------------------------------------------------------
(예시: 이름이 '이소미'인 사원의 정보와 해당 부서 정보)
*/

---------------------------------------------------------
-- [INNER JOIN 예제 - Non-ANSI 조인 구문 (이퀴 조인)]
/*
SELECT 사원번호,
       직위,
       사원.부서번호,
       부서명
FROM 사원, 부서
WHERE 사원.부서번호 = 부서.부서번호  -- 이퀴 조인: 두 테이블의 부서번호 값이 동일한 행을 결합
  AND 이름 = '이소미';
*/

---------------------------------------------------------
-- [집계 함수와 GROUP BY 예제: 주문 건수 (이퀴 조인 사용)]
-- 고객과 주문 테이블을 이퀴 조인 (INNER JOIN)하여, 
-- 각 고객별 주문 건수를 집계한 후 주문건수가 높은 순으로 정렬합니다.
SELECT 고객.고객번호, 
       담당자명, 
       고객회사명,
       COUNT(*) AS 주문건수
FROM 고객
INNER JOIN 주문
  ON 고객.고객번호 = 주문.고객번호  -- 이퀴 조인: 고객번호가 동일한 행을 결합
GROUP BY 고객.고객번호,
         담당자명,
         고객회사명
ORDER BY 주문건수 DESC;
 
/*
[예상 결과]
------------------------------------------------------------------
| 고객번호 | 담당자명 | 고객회사명 | 주문건수                    |
------------------------------------------------------------------
| C001     | 홍길동   | ABC Corp  | 25                         |
| C002     | 김철수   | XYZ Inc   | 18                         |
| ...                                                       |
------------------------------------------------------------------
(예시: 각 고객별 주문 건수를 내림차순 정렬)
*/

---------------------------------------------------------
-- [집계 함수와 다중 JOIN 예제: 주문 금액 합계 (모두 이퀴 조인)]
-- 고객, 주문, 주문세부 테이블을 각각 이퀴 조인 (INNER JOIN)하여,
-- 각 고객별로 (단가 * 주문수량)의 합계를 계산하여 주문금액합으로 출력합니다.
SELECT 고객.고객번호, 
       담당자명, 
       고객회사명,
       SUM(단가 * 주문수량) AS 주문금액합
FROM 고객 
INNER JOIN 주문
  ON 고객.고객번호 = 주문.고객번호  -- 이퀴 조인: 고객번호가 동일한 행을 결합
INNER JOIN 주문세부
  ON 주문.주문번호 = 주문세부.주문번호  -- 이퀴 조인: 주문번호가 동일한 행을 결합
GROUP BY 고객.고객번호,
         담당자명,
         고객회사명
ORDER BY 주문금액합 DESC;
 
/*
[예상 결과]
---------------------------------------------------------------------
| 고객번호 | 담당자명 | 고객회사명   | 주문금액합                  |
---------------------------------------------------------------------
| C005     | 이순신   | DEF Corp     | 500000                      |
| C001     | 홍길동   | ABC Corp     | 450000                      |
| ...                                                         |
---------------------------------------------------------------------
(예시: 주문금액합이 높은 순으로 정렬된 결과)
*/
